<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bingo Raid ‚öîÔ∏è</title>
  <style>
    :root {
      --bg: #0e1320;
      --card: #151c2b;
      --accent: #4dd2ff;
      --muted: #9ca8b8;
      --green: #32ff7e;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body {
      font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: #e8f0fa;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 2rem;
    }
    h1{text-align:center;margin-bottom:1rem;font-size:1.8rem}
    .wrapper{max-width:900px;width:100%}
    .card {
      background: var(--card);
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      position: relative;
      overflow: hidden;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap:.5rem;
      margin-bottom: 1rem;
    }
    input[type=text] {
      padding:.5rem .75rem;
      border-radius:.5rem;
      border:1px solid #333;
      background:#0c1322;
      color:#e8f0fa;
    }
    button {
      padding:.5rem 1rem;
      border-radius:.5rem;
      border:none;
      cursor:pointer;
      font-weight:600;
      transition: transform .1s;
    }
    button:hover { transform: scale(1.05); }
    #genBtn { background: var(--accent); color:#04141f; }

    #counter {
      text-align:center;
      margin-bottom: 1rem;
      font-weight:600;
      font-size:1rem;
      color: #4dd2ff;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:.75rem;
      position:relative;
    }
    .cell {
      position:relative;
      padding:.75rem;
      border-radius:.5rem;
      min-height:90px;
      background:#1c2537;
      text-align:center;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      transition:background .2s;
      overflow:hidden;
    }
    .cell input{position:absolute;inset:0;opacity:0;cursor:pointer}
    .xmark {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:3rem;
      opacity:0;
      pointer-events:none;
      transition:opacity .2s;
    }
    .cell.checked { background:#0b0f18; filter:grayscale(50%); }
    .cell.checked .xmark { opacity:1; }
    .highlight {
      animation: flash 1s ease-out;
    }
    @keyframes flash {
      0% { box-shadow: 0 0 0px var(--green); background:#1c2537; }
      50% { box-shadow: 0 0 30px 10px var(--green); background:#16442c; }
      100% { box-shadow: 0 0 0px var(--green); }
    }
    .confetti {
      position: absolute;
      width: 8px;
      height: 8px;
      background: hsl(calc(360 * var(--i)), 80%, 60%);
      top: 0;
      left: 50%;
      opacity: 0;
      animation: confettiFall 1.5s linear forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity:1; }
      100% { transform: translateY(400px) rotate(720deg); opacity:0; }
    }
    .popup {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: rgba(0,255,100,0.9);
      color: #04141f;
      font-weight: bold;
      font-size: 2rem;
      padding: 1rem 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 30px #00ff88;
      z-index: 50;
      animation: pop 1s ease-out forwards;
    }
    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0); opacity:0; }
      20% { transform: translate(-50%, -50%) scale(1.2); opacity:1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity:1; }
    }
    footer { margin-top:1rem;font-size:.85rem;color:var(--muted);text-align:center }
    @media(max-width:640px){.grid{grid-template-columns:repeat(2,1fr)}.cell{min-height:110px}}
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <h1>Bingo du Raid ‚öîÔ∏è</h1>
      <div class="controls">
        <input id="pseudoInput" type="text" placeholder="Entre ton pseudo..." />
        <button id="genBtn">üé≤ G√©n√©rer ma grille</button>
      </div>
      <div id="counter">Lignes valid√©es: 0 | Colonnes valid√©es: 0</div>
      <div id="grid" class="grid"></div>
      <footer>
        Grille unique par pseudo ‚Äî cases sauvegard√©es localement.<br>
        Partage ton lien : <code>?pseudo=TonPseudo</code>
      </footer>
    </div>
  </div>

  <script>
    const ITEMS = [
      "Mon ange","Atlance reprend l'aggro","Raxi reprend l'aggro","Mort a cause d'une charge du golem","Se prend un souffle des chiens","Pull foireux","Strat beaucoup trop longue","SEXE","P√©p√®re parle a la 3e personne","Ca demande un TP","Ca se trompe de chemin","On ne tue pas les chiens en meme temps","Fail pull","Bodypull #groscul","Se plaint des heals","Sleyzer voix un coffre et parle arabe","Encore une ceinture hunt","On attend que le mob depop parce que les demos ont fait un max rand","La carpette du raid meurt encore","Demande un robot repa"
    ];
    const COLS = 4, ROWS = 5;

    function xfnv1a(str){for(var i=0,h=2166136261>>>0;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),16777619);}return()=>{h+=0x6D2B79F5;var t=Math.imul(h^(h>>>15),1|h);t^=t+Math.imul(t^(t>>>7),61|t);return((t^(t>>>14))>>>0)/4294967296;};}
    function seededShuffle(array,seedStr){const rand=xfnv1a(seedStr);const a=array.slice();for(let i=a.length-1;i>0;i--){const r=Math.floor(rand()*(i+1));[a[i],a[r]]=[a[r],a[i]];}return a;}
    function storageKeyFor(pseudo){return 'bingo_'+pseudo.replace(/[^a-z0-9_-]/gi,'');}

    const gridEl=document.getElementById('grid');
    const pseudoInput=document.getElementById('pseudoInput');
    const genBtn=document.getElementById('genBtn');
    const counterEl = document.getElementById('counter');

    function showPopup(msg){
      const pop=document.createElement('div');
      pop.className='popup';
      pop.textContent=msg;
      document.body.appendChild(pop);
      navigator.vibrate?.(200);
      setTimeout(()=>pop.remove(),1500);
    }

    function confettiBurst(){
      for(let i=0;i<80;i++){
        const c=document.createElement('div');
        c.className='confetti';
        c.style.setProperty('--i', Math.random());
        c.style.left = Math.random()*100+'%';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),1500);
      }
    }

    function checkGrid(cells){
      // Reset highlights
      cells.forEach(c=>c.classList.remove('highlight'));

      let rowValid = new Array(ROWS).fill(false);
      let colValid = new Array(COLS).fill(false);

      // Check rows
      for(let r=0;r<ROWS;r++){
        if([...Array(COLS).keys()].every(c=>cells[r*COLS+c].querySelector('input').checked)){
          rowValid[r]=true;
          [...Array(COLS).keys()].forEach(c=>cells[r*COLS+c].classList.add('highlight'));
        }
      }

      // Check columns
      for(let c=0;c<COLS;c++){
        if([...Array(ROWS).keys()].every(r=>cells[r*COLS+c].querySelector('input').checked)){
          colValid[c]=true;
          [...Array(ROWS).keys()].forEach(r=>cells[r*COLS+c].classList.add('highlight'));
        }
      }

      // Update counter
      const totalRows = rowValid.filter(v=>v).length;
      const totalCols = colValid.filter(v=>v).length;
      counterEl.textContent = `Lignes valid√©es: ${totalRows} | Colonnes valid√©es: ${totalCols}`;

      // Show popups
      rowValid.forEach((v,r)=>{if(v) showPopup(`‚úÖ Ligne ${r+1} valid√©e !`);});
      colValid.forEach((v,c)=>{if(v) showPopup(`‚úÖ Colonne ${c+1} valid√©e !`);});

      // Entire grid
      if(cells.every(cell=>cell.querySelector('input').checked)){
        showPopup("üéâ BINGO COMPLET !");
        confettiBurst();
      }
    }

    function buildGridFor(pseudo){
      if(!pseudo) return;
      const key=storageKeyFor(pseudo);
      const order=seededShuffle(ITEMS,pseudo);
      const cellsData=order.slice(0,ROWS*COLS);
      let state={checked:{}};
      try{const raw=localStorage.getItem(key);if(raw)state=JSON.parse(raw);}catch(e){}

      gridEl.innerHTML='';
      const cells=[];
      cellsData.forEach((text,idx)=>{
        const cell=document.createElement('div');
        cell.className='cell';
        cell.dataset.idx=idx;

        const cb=document.createElement('input');
        cb.type='checkbox';
        cb.checked=!!state.checked[idx];
        if(cb.checked) cell.classList.add('checked');

        const lbl=document.createElement('div'); lbl.textContent=text;
        const x=document.createElement('div'); x.className='xmark'; x.textContent='‚úï';

        cb.addEventListener('change',()=>{
          cell.classList.toggle('checked', cb.checked);
          state.checked[idx]=cb.checked;
          localStorage.setItem(key, JSON.stringify(state));
          checkGrid(cells);
        });

        cell.append(cb,lbl,x);
        gridEl.appendChild(cell);
        cells.push(cell);
      });

      const newUrl=new URL(window.location.href);
      newUrl.searchParams.set('pseudo', pseudo);
      window.history.replaceState({}, '', newUrl);

      checkGrid(cells);
    }

    function getPseudoFromUrl(){
      const p=new URLSearchParams(window.location.search).get('pseudo');
      return p?decodeURIComponent(p):null;
    }

    genBtn.addEventListener('click',()=>{
      const p=(pseudoInput.value||'').trim();
      if(!p){alert('Entre un pseudo.');return;}
      buildGridFor(p);
    });

    window.addEventListener('load',()=>{
      const u=getPseudoFromUrl();
      if(u){pseudoInput.value=u;buildGridFor(u);}
    });
  </script>
</body>
</html>
